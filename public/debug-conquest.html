<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conquest Debug - Test Action Submission</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #00ff00;
        }

        .log {
            background: #000;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #00ff00;
            max-height: 400px;
            overflow-y: auto;
        }

        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        button:hover {
            background: #00cc00;
        }

        .success {
            color: #00ff00;
        }

        .error {
            color: #ff0000;
        }

        .info {
            color: #00aaff;
        }
    </style>
</head>

<body>
    <h1>üêõ Conquest Action Submission Debug</h1>

    <div>
        <button onclick="createRoom()">1. Create Room</button>
        <button onclick="joinRoom()">2. Join Room</button>
        <button onclick="startGame()">3. Start Game</button>
        <button onclick="submitTestActions()">4. Submit 3 Actions</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <h3>Room Code: <span id="roomCode" style="color: yellow;">---</span></h3>
    <h3>Status: <span id="status">Not started</span></h3>

    <div class="log" id="log"></div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let roomCode = null;

        function log(message, type = 'info') {
            const logEl = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logEl.innerHTML += `<div class="${type}">[${time}] ${message}</div>`;
            logEl.scrollTop = logEl.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function createRoom() {
            log('Creating conquest room...', 'info');
            socket.emit('createConquestRoom');
        }

        socket.on('conquestRoomCreated', (data) => {
            roomCode = data.roomCode;
            document.getElementById('roomCode').textContent = roomCode;
            document.getElementById('status').textContent = 'Room created';
            log(`‚úÖ Room created: ${roomCode}`, 'success');
        });

        function joinRoom() {
            if (!roomCode) {
                log('‚ùå No room code! Create room first.', 'error');
                return;
            }
            log(`Joining room ${roomCode}...`, 'info');
            socket.emit('joinConquestRoom', { roomCode, nickname: 'DebugPlayer' });
        }

        socket.on('conquestJoined', () => {
            document.getElementById('status').textContent = 'Joined room';
            log(`‚úÖ Joined room successfully`, 'success');
        });

        function startGame() {
            if (!roomCode) {
                log('‚ùå No room code!', 'error');
                return;
            }
            log('Starting game...', 'info');
            socket.emit('startConquestGame', { roomCode });
        }

        socket.on('conquestRoundStart', (data) => {
            document.getElementById('status').textContent = `Round ${data.roundNumber}`;
            log(`üéÆ Round ${data.roundNumber} started - Duration: ${data.duration}ms`, 'success');
        });

        function submitTestActions() {
            if (!roomCode) {
                log('‚ùå No room code!', 'error');
                return;
            }

            const actions = [
                { x: 1, y: 1 },
                { x: 2, y: 2 },
                { x: 3, y: 3 }
            ];

            log(`üì§ Submitting ${actions.length} actions: ${JSON.stringify(actions)}`, 'info');
            socket.emit('conquestSubmitActions', { roomCode, actions });
            log('‚úÖ Actions emitted to server', 'success');
        }

        socket.on('conquestMapUpdate', (data) => {
            let claimed = 0;
            for (let x = 0; x < 10; x++) {
                for (let y = 0; y < 10; y++) {
                    if (data.grid[x][y] !== null) claimed++;
                }
            }
            log(`üìä MAP UPDATE: ${claimed} cells claimed, ${data.conflictsThisRound.length} conflicts`, 'success');
        });

        socket.on('conquestRoundEnd', (data) => {
            log(`üèÅ Round ended - Your territory: ${data.yourTerritory}`, 'success');
        });

        socket.on('error', (data) => {
            log(`‚ùå Error: ${data.message}`, 'error');
        });

        log('Debug page loaded. Follow steps 1-4 to test.', 'info');
    </script>
</body>

</html>