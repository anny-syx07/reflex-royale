<!DOCTYPE html><html lang="vi"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Campus Conquest - Player</title><link rel="stylesheet" href="/css/conquest.css"><style>.player-container{display:flex;flex-direction:column;height:100vh;padding:10px}.header{background:#fff;border-radius:12px;padding:15px;margin-bottom:10px;box-shadow:0 2px 8px rgba(0,0,0,.1)}.game-title{font-size:20px;font-weight:700;color:var(--primary-purple);text-align:center;margin-bottom:10px}.status-bar{display:flex;justify-content:space-between;align-items:center;padding:10px 0}.timer-display{font-size:32px;font-weight:700;color:var(--primary-purple)}.timer-display.warning{color:#ff6b6b;animation:timerPulse .5s infinite}@keyframes timerPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}.round-display{font-size:16px;font-weight:600;color:#666}.grid-wrapper{flex:1;display:flex;align-items:center;justify-content:center;overflow:auto}.footer{background:#fff;border-radius:12px;padding:15px;margin-top:10px;box-shadow:0 2px 8px rgba(0,0,0,.1)}.your-stats{display:flex;justify-content:space-around;text-align:center}.stat{flex:1}.stat-label{font-size:12px;color:#999;margin-bottom:5px}.stat-value{font-size:24px;font-weight:700;color:var(--primary-purple)}.game-over-screen,.waiting-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,var(--primary-purple) 0,var(--primary-pink) 100%);display:none;flex-direction:column;justify-content:center;align-items:center;z-index:1000;color:#fff;padding:20px;text-align:center}.game-over-screen.show,.waiting-screen.show{display:flex}.big-icon{font-size:80px;margin-bottom:20px}.big-title{font-size:36px;font-weight:700;margin-bottom:20px}.message{font-size:18px;margin-bottom:30px}.final-rank{font-size:48px;font-weight:700;margin:20px 0}.final-score{font-size:32px;margin-bottom:30px}.back-btn{position:fixed;top:20px;left:20px;width:50px;height:50px;border-radius:50%;background:#fff;border:none;font-size:24px;cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,.15);z-index:9999;display:flex;align-items:center;justify-content:center;transition:all .3s}.back-btn:hover{transform:scale(1.1);box-shadow:0 6px 16px rgba(0,0,0,.2)}body.in-game .back-btn{display:none!important}</style></head><body><button class="back-btn" onclick='window.location.href="/player.html"' title="Quay l·∫°i">‚¨ÖÔ∏è</button><div class="player-container" id="gameContainer" style="display:none"><div class="header"><div class="game-title">üèõÔ∏è ƒê·∫†I CHI·∫æN GI·∫¢NG ƒê∆Ø·ªúNG</div><div class="status-bar"><div class="round-display" id="roundDisplay">Round 1/12</div><div class="timer-display" id="timer">12</div><div class="ap-display" id="apDisplay"></div></div></div><div class="grid-wrapper"><div id="gridContainer"></div></div><div class="footer"><div class="your-stats"><div class="stat"><div class="stat-label">Your Territory</div><div class="stat-value" id="territoryCount">0</div></div><div class="stat"><div class="stat-label">Your Rank</div><div class="stat-value" id="playerRank">-</div></div></div></div></div><div class="waiting-screen show" id="waitingScreen"><div class="big-icon">‚è≥</div><div class="big-title">Waiting for Game...</div><div class="message">Nh·∫≠p m√£ ph√≤ng ƒë·ªÉ tham gia</div><div style="margin-top:20px"><input id="roomCodeInput" placeholder="Room Code" style="padding:15px;font-size:18px;border-radius:8px;border:none;text-align:center;text-transform:uppercase;width:200px;margin-bottom:15px"><br><input id="nicknameInput" placeholder="Your Nickname" style="padding:15px;font-size:18px;border-radius:8px;border:none;text-align:center;width:200px;margin-bottom:15px"><br><button onclick="joinGame()" style="padding:15px 40px;font-size:18px;font-weight:700;border-radius:8px;border:none;background:#fff;color:var(--primary-purple);cursor:pointer">Tham Gia</button></div></div><div class="game-over-screen" id="gameOverScreen"><div class="big-icon">üèÜ</div><div class="big-title">Tr√≤ Ch∆°i K·∫øt Th√∫c!</div><div class="final-rank" id="finalRank">#1</div><div class="final-score" id="finalScore">50 territories</div><div class="message">C·∫£m ∆°n b·∫°n ƒë√£ ch∆°i!</div></div><script src="/socket.io/socket.io.js"></script><script src="/js/conquest-game.js"></script><script>const socket=io();let roomCode=null,playerId=null,nickname="",grid=null,renderer=null,currentAP=3,maxAP=3,pendingActions=[],timerInterval=null,failsafeTimeout=null;const urlParams=new URLSearchParams(window.location.search),urlRoomCode=urlParams.get("roomCode"),urlNickname=urlParams.get("nickname");function joinGame(){roomCode=document.getElementById("roomCodeInput").value.trim().toUpperCase(),nickname=document.getElementById("nicknameInput").value.trim()||"Player",roomCode?socket.emit("joinConquestRoom",{roomCode:roomCode,nickname:nickname}):alert("Vui l√≤ng nh·∫≠p m√£ ph√≤ng!")}function handleCellClick(e,t){if(null!==grid.getCell(e,t))return;const n=`${e},${t}`,o=pendingActions.findIndex(e=>`${e.x},${e.y}`===n);o>=0?(pendingActions.splice(o,1),currentAP++,renderer.markPending(e,t,!1)):currentAP>0&&(pendingActions.push({x:e,y:t}),currentAP--,renderer.markPending(e,t,!0),playSound("click")),updateAPDisplay()}function updateAPDisplay(){const e=document.getElementById("apDisplay");e.innerHTML="";for(let t=0;t<maxAP;t++){const n=document.createElement("div");n.className="ap-dot",t<maxAP-currentAP&&n.classList.add("active"),e.appendChild(n)}}function startTimer(e){let t=e;const n=document.getElementById("timer");timerInterval&&clearInterval(timerInterval),timerInterval=setInterval(()=>{t--,n.textContent=t,t<=3?n.classList.add("warning"):n.classList.remove("warning"),t<=0&&(clearInterval(timerInterval),console.log("[Conquest Client] Timer ended - auto submitting"),submitActions())},1e3),failsafeTimeout&&clearTimeout(failsafeTimeout),failsafeTimeout=setTimeout(()=>{console.log("[Conquest Client] Failsafe auto-submit triggered"),submitActions()},1e3*(e+1))}urlRoomCode&&urlNickname&&(document.getElementById("roomCodeInput").value=urlRoomCode,document.getElementById("nicknameInput").value=urlNickname,setTimeout(()=>joinGame(),500)),socket.on("conquestJoined",({roomCode:e,playerId:t})=>{playerId=t,roomCode=e,document.body.classList.add("in-game"),document.getElementById("waitingScreen").classList.remove("show"),document.getElementById("gameContainer").style.display="flex"}),socket.on("conquestRoundStart",e=>{const{roundNumber:t,maxRounds:n,currentAP:o,mapState:r}=e;if(document.getElementById("roundDisplay").textContent=`Round ${t}/${n}`,currentAP=o,maxAP=o,pendingActions=[],hasSubmitted=!1,timerInterval&&clearInterval(timerInterval),failsafeTimeout&&clearTimeout(failsafeTimeout),!grid){grid=new ConquestGrid(10);const e=document.getElementById("gridContainer");renderer=new ConquestRenderer(e,grid,{clickable:!0}),renderer.onCellClick=handleCellClick,renderer.render()}grid.import(r);for(let e=0;e<grid.size;e++)for(let t=0;t<grid.size;t++)renderer.updateCell(e,t);updateAPDisplay(),startTimer(e.duration/1e3)});let hasSubmitted=!1;function submitActions(){hasSubmitted?console.log("[Conquest Client] Already submitted, skipping"):(console.log("[Conquest Client] Submitting actions:",pendingActions),pendingActions.length>0?(socket.emit("conquestSubmitActions",{roomCode:roomCode,actions:pendingActions}),hasSubmitted=!0,console.log("[Conquest Client] Actions sent to server")):(console.log("[Conquest Client] No actions to submit"),hasSubmitted=!0))}socket.on("conquestRoundEnd",e=>{const{mapState:t,conflicts:n,yourTerritory:o,yourRank:r}=e;grid.import(t),n.forEach(({x:e,y:t})=>{renderer.showConflict(e,t)});for(let e=0;e<grid.size;e++)for(let t=0;t<grid.size;t++)renderer.updateCell(e,t);document.getElementById("territoryCount").textContent=o||0,document.getElementById("playerRank").textContent=r?`#${r}`:"-",pendingActions=[]}),socket.on("conquestGameOver",e=>{const{yourRank:t,yourTerritory:n}=e;document.getElementById("finalRank").textContent=`#${t}`,document.getElementById("finalScore").textContent=`${n} territories`,document.getElementById("gameOverScreen").classList.add("show");const o=document.getElementById("gameOverScreen");if(!o.querySelector(".play-again-btn")){const e=document.createElement("button");e.className="play-again-btn",e.textContent="üéÆ CH∆†I L·∫†I",e.style.cssText="padding: 15px 40px; margin-top: 30px; font-size: 18px; font-weight: bold; border-radius: 8px; border: none; background: white; color: var(--primary-purple); cursor: pointer;",e.onclick=()=>window.location.href="/player.html",o.querySelector("div").appendChild(e)}}),socket.on("error",e=>{alert(e.message)})</script></body></html>